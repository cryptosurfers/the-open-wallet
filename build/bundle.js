var app=function(){"use strict";function e(){}const t=e=>e;function n(e,t){for(const n in t)e[n]=t[n];return e}function s(e){return e()}function i(){return Object.create(null)}function a(e){e.forEach(s)}function o(e){return"function"==typeof e}function r(e,t){return e!=e?t==t:e!==t||e&&"object"==typeof e||"function"==typeof e}function c(e,t,n,s){if(e){const i=l(e,t,n,s);return e[0](i)}}function l(e,t,s,i){return e[1]&&i?n(s.ctx.slice(),e[1](i(t))):s.ctx}function d(e,t,n,s){if(e[2]&&s){const i=e[2](s(n));if(void 0===t.dirty)return i;if("object"==typeof i){const e=[],n=Math.max(t.dirty.length,i.length);for(let s=0;s<n;s+=1)e[s]=t.dirty[s]|i[s];return e}return t.dirty|i}return t.dirty}function u(e,t,n,s,i,a){if(i){const o=l(t,n,s,a);e.p(o,i)}}function h(e){if(e.ctx.length>32){const t=[],n=e.ctx.length/32;for(let e=0;e<n;e++)t[e]=-1;return t}return-1}function p(e){const t={};for(const n in e)"$"!==n[0]&&(t[n]=e[n]);return t}function m(e){return null==e?"":e}const w="undefined"!=typeof window;let f=w?()=>window.performance.now():()=>Date.now(),g=w?e=>requestAnimationFrame(e):e;const y=new Set;function $(e){y.forEach((t=>{t.c(e)||(y.delete(t),t.f())})),0!==y.size&&g($)}function b(e,t){e.appendChild(t)}function T(e){if(!e)return document;const t=e.getRootNode?e.getRootNode():e.ownerDocument;return t&&t.host?t:e.ownerDocument}function v(e){const t=P("style");return function(e,t){b(e.head||e,t)}(T(e),t),t.sheet}function A(e,t,n){e.insertBefore(t,n||null)}function C(e){e.parentNode.removeChild(e)}function P(e){return document.createElement(e)}function x(e){return document.createTextNode(e)}function I(){return x(" ")}function S(e,t,n,s){return e.addEventListener(t,n,s),()=>e.removeEventListener(t,n,s)}function k(e,t,n){null==n?e.removeAttribute(t):e.getAttribute(t)!==n&&e.setAttribute(t,n)}function _(e,t){t=""+t,e.wholeText!==t&&(e.data=t)}function E(e,t){e.value=null==t?"":t}function K(e,t,n,s){null===n?e.style.removeProperty(t):e.style.setProperty(t,n,s?"important":"")}function W(e,t,n){e.classList[n?"add":"remove"](t)}function V(e,t,{bubbles:n=!1,cancelable:s=!1}={}){const i=document.createEvent("CustomEvent");return i.initCustomEvent(e,n,s,t),i}const D=new Map;let B,M=0;function R(e,t,n,s,i,a,o,r=0){const c=16.666/s;let l="{\n";for(let e=0;e<=1;e+=c){const s=t+(n-t)*a(e);l+=100*e+`%{${o(s,1-s)}}\n`}const d=l+`100% {${o(n,1-n)}}\n}`,u=`__svelte_${function(e){let t=5381,n=e.length;for(;n--;)t=(t<<5)-t^e.charCodeAt(n);return t>>>0}(d)}_${r}`,h=T(e),{stylesheet:p,rules:m}=D.get(h)||function(e,t){const n={stylesheet:v(t),rules:{}};return D.set(e,n),n}(h,e);m[u]||(m[u]=!0,p.insertRule(`@keyframes ${u} ${d}`,p.cssRules.length));const w=e.style.animation||"";return e.style.animation=`${w?`${w}, `:""}${u} ${s}ms linear ${i}ms 1 both`,M+=1,u}function L(e,t){const n=(e.style.animation||"").split(", "),s=n.filter(t?e=>e.indexOf(t)<0:e=>-1===e.indexOf("__svelte")),i=n.length-s.length;i&&(e.style.animation=s.join(", "),M-=i,M||g((()=>{M||(D.forEach((e=>{const{stylesheet:t}=e;let n=t.cssRules.length;for(;n--;)t.deleteRule(n);e.rules={}})),D.clear())})))}function O(e){B=e}function N(){if(!B)throw new Error("Function called outside component initialization");return B}function q(e,t){const n=e.$$.callbacks[t.type];n&&n.slice().forEach((e=>e.call(this,t)))}const z=[],F=[],H=[],U=[],j=Promise.resolve();let G=!1;function Y(){G||(G=!0,j.then(te))}function J(e){H.push(e)}function Q(e){U.push(e)}const X=new Set;let Z,ee=0;function te(){const e=B;do{for(;ee<z.length;){const e=z[ee];ee++,O(e),ne(e.$$)}for(O(null),z.length=0,ee=0;F.length;)F.pop()();for(let e=0;e<H.length;e+=1){const t=H[e];X.has(t)||(X.add(t),t())}H.length=0}while(z.length);for(;U.length;)U.pop()();G=!1,X.clear(),O(e)}function ne(e){if(null!==e.fragment){e.update(),a(e.before_update);const t=e.dirty;e.dirty=[-1],e.fragment&&e.fragment.p(e.ctx,t),e.after_update.forEach(J)}}function se(e,t,n){e.dispatchEvent(V(`${t?"intro":"outro"}${n}`))}const ie=new Set;let ae;function oe(){ae={r:0,c:[],p:ae}}function re(){ae.r||a(ae.c),ae=ae.p}function ce(e,t){e&&e.i&&(ie.delete(e),e.i(t))}function le(e,t,n,s){if(e&&e.o){if(ie.has(e))return;ie.add(e),ae.c.push((()=>{ie.delete(e),s&&(n&&e.d(1),s())})),e.o(t)}}const de={duration:0};function ue(n,s,i,r){let c=s(n,i),l=r?0:1,d=null,u=null,h=null;function p(){h&&L(n,h)}function m(e,t){const n=e.b-l;return t*=Math.abs(n),{a:l,b:e.b,d:n,duration:t,start:e.start,end:e.start+t,group:e.group}}function w(s){const{delay:i=0,duration:o=300,easing:r=t,tick:w=e,css:b}=c||de,T={start:f()+i,b:s};s||(T.group=ae,ae.r+=1),d||u?u=T:(b&&(p(),h=R(n,l,s,o,i,r,b)),s&&w(0,1),d=m(T,o),J((()=>se(n,s,"start"))),function(e){let t;0===y.size&&g($),new Promise((n=>{y.add(t={c:e,f:n})}))}((e=>{if(u&&e>u.start&&(d=m(u,o),u=null,se(n,d.b,"start"),b&&(p(),h=R(n,l,d.b,d.duration,0,r,c.css))),d)if(e>=d.end)w(l=d.b,1-l),se(n,d.b,"end"),u||(d.b?p():--d.group.r||a(d.group.c)),d=null;else if(e>=d.start){const t=e-d.start;l=d.a+d.d*r(t/d.duration),w(l,1-l)}return!(!d&&!u)})))}return{run(e){o(c)?(Z||(Z=Promise.resolve(),Z.then((()=>{Z=null}))),Z).then((()=>{c=c(),w(e)})):w(e)},end(){p(),d=u=null}}}function he(e,t,n){const s=e.$$.props[t];void 0!==s&&(e.$$.bound[s]=n,n(e.$$.ctx[s]))}function pe(e){e&&e.c()}function me(e,t,n,i){const{fragment:r,on_mount:c,on_destroy:l,after_update:d}=e.$$;r&&r.m(t,n),i||J((()=>{const t=c.map(s).filter(o);l?l.push(...t):a(t),e.$$.on_mount=[]})),d.forEach(J)}function we(e,t){const n=e.$$;null!==n.fragment&&(a(n.on_destroy),n.fragment&&n.fragment.d(t),n.on_destroy=n.fragment=null,n.ctx=[])}function fe(t,n,s,o,r,c,l,d=[-1]){const u=B;O(t);const h=t.$$={fragment:null,ctx:null,props:c,update:e,not_equal:r,bound:i(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(n.context||(u?u.$$.context:[])),callbacks:i(),dirty:d,skip_bound:!1,root:n.target||u.$$.root};l&&l(h.root);let p=!1;if(h.ctx=s?s(t,n.props||{},((e,n,...s)=>{const i=s.length?s[0]:n;return h.ctx&&r(h.ctx[e],h.ctx[e]=i)&&(!h.skip_bound&&h.bound[e]&&h.bound[e](i),p&&function(e,t){-1===e.$$.dirty[0]&&(z.push(e),Y(),e.$$.dirty.fill(0)),e.$$.dirty[t/31|0]|=1<<t%31}(t,e)),n})):[],h.update(),p=!0,a(h.before_update),h.fragment=!!o&&o(h.ctx),n.target){if(n.hydrate){const e=function(e){return Array.from(e.childNodes)}(n.target);h.fragment&&h.fragment.l(e),e.forEach(C)}else h.fragment&&h.fragment.c();n.intro&&ce(t.$$.fragment),me(t,n.target,n.anchor,n.customElement),te()}O(u)}class ge{$destroy(){we(this,1),this.$destroy=e}$on(e,t){const n=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return n.push(t),()=>{const e=n.indexOf(t);-1!==e&&n.splice(e,1)}}$set(e){var t;this.$$set&&(t=e,0!==Object.keys(t).length)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}}var ye=self.localStorage;const $e=e=>e?.match(/^.{6}|.{4}$/g)?.join("..."),be=()=>{const e=location.search.substring(1);return JSON.parse('{"'+decodeURI(e).replace(/"/g,'\\"').replace(/&/g,'","').replace(/=/g,'":"')+'"}')};function Te(e){let t,n,s,i,o,r;const l=e[10].default,p=c(l,e,e[9],null);return{c(){t=P("button"),n=P("span"),p&&p.c(),k(t,"class",s=m(e[2])+" svelte-sfpspx"),K(t,"width",e[1]?"":e[0]),k(t,"type","button")},m(s,a){A(s,t,a),b(t,n),p&&p.m(n,null),i=!0,o||(r=[S(t,"click",e[11]),S(t,"keypress",e[12])],o=!0)},p(e,[n]){p&&p.p&&(!i||512&n)&&u(p,l,e,e[9],i?d(l,e[9],n,null):h(e[9]),null),(!i||4&n&&s!==(s=m(e[2])+" svelte-sfpspx"))&&k(t,"class",s),(!i||3&n)&&K(t,"width",e[1]?"":e[0])},i(e){i||(ce(p,e),i=!0)},o(e){le(p,e),i=!1},d(e){e&&C(t),p&&p.d(e),o=!1,a(r)}}}function ve(e,t,s){let i,{$$slots:a={},$$scope:o}=t,{size:r="lg"}=t,{type:c="default"}=t,{icon:l=""}=t,{label:d=""}=t,{width:u=""}=t,{wide:h=!1}=t,{loading:m=!1}=t,{disabled:w=!1}=t,f=t.class||t.className||"";return e.$$set=e=>{s(14,t=n(n({},t),p(e))),"size"in e&&s(3,r=e.size),"type"in e&&s(4,c=e.type),"icon"in e&&s(5,l=e.icon),"label"in e&&s(6,d=e.label),"width"in e&&s(0,u=e.width),"wide"in e&&s(1,h=e.wide),"loading"in e&&s(7,m=e.loading),"disabled"in e&&s(8,w=e.disabled),"$$scope"in e&&s(9,o=e.$$scope)},e.$$.update=()=>{410&e.$$.dirty&&s(2,i=[c,r,f,h&&"wide",m&&"loading",w&&"disabled"].filter((e=>e)).join(" "))},t=p(t),[u,h,i,r,c,l,d,m,w,o,a,function(t){q.call(this,e,t)},function(t){q.call(this,e,t)}]}class Ae extends ge{constructor(e){super(),fe(this,e,ve,Te,r,{size:3,type:4,icon:5,label:6,width:0,wide:1,loading:7,disabled:8})}}function Ce(t){let n,s,i,o,r,c;return{c(){n=P("div"),s=P("div"),i=P("input"),k(i,"type","text"),k(i,"name",t[8]),k(i,"placeholder",t[4]),i.readOnly=t[2],i.disabled=t[3],k(i,"autocomplete","off"),k(i,"class","svelte-1t38hh3"),k(s,"class","inp svelte-1t38hh3"),k(n,"class",o=m(t[9])+" svelte-1t38hh3"),k(n,"style",t[6]),W(n,"error",t[7]),W(n,"success",t[5]),W(n,"readonly",t[2]),W(n,"disabled",t[3])},m(e,a){A(e,n,a),b(n,s),b(s,i),t[27](i),E(i,t[0]),r||(c=[S(i,"input",t[28]),S(i,"focus",t[10]),S(i,"blur",t[11]),S(i,"input",t[12]),S(i,"focus",t[20]),S(i,"blur",t[21]),S(i,"input",t[22]),S(i,"change",t[23]),S(i,"keypress",t[24]),S(i,"keydown",t[25]),S(i,"keyup",t[26])],r=!0)},p(e,t){256&t[0]&&k(i,"name",e[8]),16&t[0]&&k(i,"placeholder",e[4]),4&t[0]&&(i.readOnly=e[2]),8&t[0]&&(i.disabled=e[3]),1&t[0]&&i.value!==e[0]&&E(i,e[0]),512&t[0]&&o!==(o=m(e[9])+" svelte-1t38hh3")&&k(n,"class",o),64&t[0]&&k(n,"style",e[6]),640&t[0]&&W(n,"error",e[7]),544&t[0]&&W(n,"success",e[5]),516&t[0]&&W(n,"readonly",e[2]),520&t[0]&&W(n,"disabled",e[3])},i:e,o:e,d(e){e&&C(n),t[27](null),r=!1,a(c)}}}function Pe(e,t,s){let i,a,o,{size:r="md"}=t,{value:c=""}=t,{readonly:l=!1}=t,{disabled:d=!1}=t,{placeholder:u=null}=t,{validateOnBlur:h=!1}=t,{rules:m=[]}=t,{success:w=!1}=t,{style:f=null}=t,{inputElement:g=null}=t,{message:y=""}=t,{error:$=""}=t,{name:b=""}=t,T=t.class||t.className||"",v=!1,A=[];function C(){return A=m.map((e=>e(c))).filter((e=>"string"==typeof e)),a=!!A.length||!!$,a}return e.$$set=e=>{s(32,t=n(n({},t),p(e))),"size"in e&&s(13,r=e.size),"value"in e&&s(0,c=e.value),"readonly"in e&&s(2,l=e.readonly),"disabled"in e&&s(3,d=e.disabled),"placeholder"in e&&s(4,u=e.placeholder),"validateOnBlur"in e&&s(14,h=e.validateOnBlur),"rules"in e&&s(15,m=e.rules),"success"in e&&s(5,w=e.success),"style"in e&&s(6,f=e.style),"inputElement"in e&&s(1,g=e.inputElement),"message"in e&&s(16,y=e.message),"error"in e&&s(7,$=e.error),"name"in e&&s(8,b=e.name)},e.$$.update=()=>{1&e.$$.dirty[0]&&s(19,i=!!c),128&e.$$.dirty[0]&&(a=!!$),794624&e.$$.dirty[0]&&s(9,o=[T,r,v&&"focused",i&&"filled"].filter((e=>e)).join(" "))},t=p(t),[c,g,l,d,u,w,f,$,b,o,function(){s(18,v=!0)},function(){s(18,v=!1),h&&C()},function(){h||C()},r,h,m,y,C,v,i,function(t){q.call(this,e,t)},function(t){q.call(this,e,t)},function(t){q.call(this,e,t)},function(t){q.call(this,e,t)},function(t){q.call(this,e,t)},function(t){q.call(this,e,t)},function(t){q.call(this,e,t)},function(e){F[e?"unshift":"push"]((()=>{g=e,s(1,g)}))},function(){c=this.value,s(0,c)}]}class xe extends ge{constructor(e){super(),fe(this,e,Pe,Ce,r,{size:13,value:0,readonly:2,disabled:3,placeholder:4,validateOnBlur:14,rules:15,success:5,style:6,inputElement:1,message:16,error:7,name:8,validate:17},null,[-1,-1])}get validate(){return this.$$.ctx[17]}}const Ie=window.TonWeb;class Se{channelId;addressA;addressB;initBalanceA;initBalanceB;isA;myKeyPair;hisPublicKey;apiKey;providerUrl;ton;channel;fromWallet;wallet;constructor(e,t,n,s,i,a,o,r,c,l){this.channelId=e,this.addressA=t,this.addressB=n,this.initBalanceA=s,this.initBalanceB=i,this.isA=a,this.myKeyPair=o,this.hisPublicKey=r,this.apiKey=c,this.providerUrl=l,this.channelId=e,this.addressA=t,this.addressB=n,this.initBalanceA=s,this.initBalanceB=i,this.isA=a,this.myKeyPair=o,this.hisPublicKey=r,this.ton=new Ie(new Ie.HttpProvider(l,{apiKey:c})),this.channel=this.ton.payments.createChannel({channelId:e,addressA:t,addressB:n,initBalanceA:s,initBalanceB:i,isA:a,myKeyPair:o,hisPublicKey:r}),this.wallet=this.ton.wallet.create({publicKey:o.publicKey}),this.fromWallet=this.channel.fromWallet({wallet:this.wallet,secretKey:o.secretKey})}}function ke(t){let n,s,i,a,r;const l=t[2].default,p=c(l,t,t[1],null);return{c(){n=P("div"),p&&p.c(),n.hidden=!0},m(c,l){var d;A(c,n,l),p&&p.m(n,null),i=!0,a||(d=s=_e.call(null,n,t[0]),r=d&&o(d.destroy)?d.destroy:e,a=!0)},p(e,[t]){p&&p.p&&(!i||2&t)&&u(p,l,e,e[1],i?d(l,e[1],t,null):h(e[1]),null),s&&o(s.update)&&1&t&&s.update.call(null,e[0])},i(e){i||(ce(p,e),i=!0)},o(e){le(p,e),i=!1},d(e){e&&C(n),p&&p.d(e),a=!1,r()}}}function _e(e,t="body"){let n;async function s(s){if("string"==typeof(t=s)){if(n=document.querySelector(t),null===n&&(await(Y(),j),n=document.querySelector(t)),null===n)throw new Error(`No element found matching css selector: "${t}"`)}else{if(!(t instanceof HTMLElement))throw new TypeError(`Unknown portal target type: ${null===t?"null":typeof t}. Allowed types: string (CSS selector) or HTMLElement.`);n=t}n.appendChild(e),e.hidden=!1}return s(t),{update:s,destroy:function(){e.parentNode&&e.parentNode.removeChild(e)}}}function Ee(e,t,n){let{$$slots:s={},$$scope:i}=t,{target:a="body"}=t;return e.$$set=e=>{"target"in e&&n(0,a=e.target),"$$scope"in e&&n(1,i=e.$$scope)},[a,i,s]}class Ke extends ge{constructor(e){super(),fe(this,e,Ee,ke,r,{target:0})}}function We(e,{delay:n=0,duration:s=400,easing:i=t}={}){const a=+getComputedStyle(e).opacity;return{delay:n,duration:s,easing:i,css:e=>"opacity: "+e*a}}const Ve=e=>({}),De=e=>({}),Be=e=>({}),Me=e=>({});function Re(e){let t,n;return t=new Ke({props:{$$slots:{default:[Ne]},$$scope:{ctx:e}}}),{c(){pe(t.$$.fragment)},m(e,s){me(t,e,s),n=!0},p(e,n){const s={};1534&n&&(s.$$scope={dirty:n,ctx:e}),t.$set(s)},i(e){n||(ce(t.$$.fragment,e),n=!0)},o(e){le(t.$$.fragment,e),n=!1},d(e){we(t,e)}}}function Le(e){let t,n;return{c(){t=P("h2"),n=x(e[4]),k(t,"class","title svelte-1d7qn1e")},m(e,s){A(e,t,s),b(t,n)},p(e,t){16&t&&_(n,e[4])},d(e){e&&C(t)}}}function Oe(e){let t,n;const s=e[9].controls,i=c(s,e,e[10],De);return{c(){t=P("div"),i&&i.c(),k(t,"class","controls svelte-1d7qn1e")},m(e,s){A(e,t,s),i&&i.m(t,null),n=!0},p(e,t){i&&i.p&&(!n||1024&t)&&u(i,s,e,e[10],n?d(s,e[10],t,Ve):h(e[10]),De)},i(e){n||(ce(i,e),n=!0)},o(e){le(i,e),n=!1},d(e){e&&C(t),i&&i.d(e)}}}function Ne(e){let t,n,s,i,a,r,l,p,m,w,f,g;const y=e[9].prepend,$=c(y,e,e[10],Me);let T=e[4]&&!e[2]&&Le(e);const v=e[9].default,x=c(v,e,e[10],null);let _=e[8].controls&&Oe(e);return{c(){t=P("div"),n=P("div"),s=I(),i=P("div"),$&&$.c(),a=I(),r=P("div"),T&&T.c(),l=I(),x&&x.c(),p=I(),_&&_.c(),k(n,"class","overlay svelte-1d7qn1e"),k(i,"class","modal svelte-1d7qn1e"),W(i,"full",e[6]),W(i,"modal--empty-desc",e[3]),W(i,"modal--empty",e[2]),k(t,"class","wrapper svelte-1d7qn1e"),K(t,"--modal-width",e[5]),K(t,"z-index",e[1])},m(c,d){A(c,t,d),b(t,n),b(t,s),b(t,i),$&&$.m(i,null),b(i,a),b(i,r),T&&T.m(r,null),b(r,l),x&&x.m(r,null),b(i,p),_&&_.m(i,null),w=!0,f||(g=S(n,"click",(function(){o(e[7])&&e[7].apply(this,arguments)})),f=!0)},p(n,s){e=n,$&&$.p&&(!w||1024&s)&&u($,y,e,e[10],w?d(y,e[10],s,Be):h(e[10]),Me),e[4]&&!e[2]?T?T.p(e,s):(T=Le(e),T.c(),T.m(r,l)):T&&(T.d(1),T=null),x&&x.p&&(!w||1024&s)&&u(x,v,e,e[10],w?d(v,e[10],s,null):h(e[10]),null),e[8].controls?_?(_.p(e,s),256&s&&ce(_,1)):(_=Oe(e),_.c(),ce(_,1),_.m(i,null)):_&&(oe(),le(_,1,1,(()=>{_=null})),re()),64&s&&W(i,"full",e[6]),8&s&&W(i,"modal--empty-desc",e[3]),4&s&&W(i,"modal--empty",e[2]),(!w||32&s)&&K(t,"--modal-width",e[5]),(!w||2&s)&&K(t,"z-index",e[1])},i(e){w||(ce($,e),ce(x,e),ce(_),J((()=>{m||(m=ue(t,We,{duration:100},!0)),m.run(1)})),w=!0)},o(e){le($,e),le(x,e),le(_),m||(m=ue(t,We,{duration:100},!1)),m.run(0),w=!1},d(e){e&&C(t),$&&$.d(e),T&&T.d(),x&&x.d(e),_&&_.d(),e&&m&&m.end(),f=!1,g()}}}function qe(e){let t,n,s=e[0]&&Re(e);return{c(){s&&s.c(),t=x("")},m(e,i){s&&s.m(e,i),A(e,t,i),n=!0},p(e,[n]){e[0]?s?(s.p(e,n),1&n&&ce(s,1)):(s=Re(e),s.c(),ce(s,1),s.m(t.parentNode,t)):s&&(oe(),le(s,1,1,(()=>{s=null})),re())},i(e){n||(ce(s),n=!0)},o(e){le(s),n=!1},d(e){s&&s.d(e),e&&C(t)}}}function ze(e,t,n){let{$$slots:s={},$$scope:i}=t;const a=function(e){const t={};for(const n in e)t[n]=!0;return t}(s),o=function(){const e=N();return(t,n,{cancelable:s=!1}={})=>{const i=e.$$.callbacks[t];if(i){const a=V(t,n,{cancelable:s});return i.slice().forEach((t=>{t.call(e,a)})),!a.defaultPrevented}return!0}}();let{z_index:r=100}=t,{empty:c=!1}=t,{emptyDesc:l=!1}=t,{title:d=""}=t,{open:u=!1}=t,{width:h="40rem"}=t,{fullScreen:p=!1}=t,{close:m=(()=>{n(0,u=!1),o("modalClosed")})}=t;return e.$$set=e=>{"z_index"in e&&n(1,r=e.z_index),"empty"in e&&n(2,c=e.empty),"emptyDesc"in e&&n(3,l=e.emptyDesc),"title"in e&&n(4,d=e.title),"open"in e&&n(0,u=e.open),"width"in e&&n(5,h=e.width),"fullScreen"in e&&n(6,p=e.fullScreen),"close"in e&&n(7,m=e.close),"$$scope"in e&&n(10,i=e.$$scope)},[u,r,c,l,d,h,p,m,a,s,i]}class Fe extends ge{constructor(e){super(),fe(this,e,ze,qe,r,{z_index:1,empty:2,emptyDesc:3,title:4,open:0,width:5,fullScreen:6,close:7})}}function He(e){let t;return{c(){t=x("Confirm")},m(e,n){A(e,t,n)},d(e){e&&C(t)}}}function Ue(e){let t,n,s,i,a,o,r;return s=new Ae({props:{wide:!0,type:"accent",$$slots:{default:[He]},$$scope:{ctx:e}}}),s.$on("click",e[5]),{c(){t=P("h2"),t.textContent="Sign Transaction",n=I(),pe(s.$$.fragment),i=I(),a=P("div"),o=x(e[1]),k(a,"class","error")},m(e,c){A(e,t,c),A(e,n,c),me(s,e,c),A(e,i,c),A(e,a,c),b(a,o),r=!0},p(e,t){const n={};256&t&&(n.$$scope={dirty:t,ctx:e}),s.$set(n),(!r||2&t)&&_(o,e[1])},i(e){r||(ce(s.$$.fragment,e),r=!0)},o(e){le(s.$$.fragment,e),r=!1},d(e){e&&C(t),e&&C(n),we(s,e),e&&C(i),e&&C(a)}}}function je(e){let t,n;return t=new Fe({props:{open:e[0],$$slots:{default:[Ue]},$$scope:{ctx:e}}}),{c(){pe(t.$$.fragment)},m(e,s){me(t,e,s),n=!0},p(e,[n]){const s={};1&n&&(s.open=e[0]),258&n&&(s.$$scope={dirty:n,ctx:e}),t.$set(s)},i(e){n||(ce(t.$$.fragment,e),n=!0)},o(e){le(t.$$.fragment,e),n=!1},d(e){we(t,e)}}}function Ge(e,t,n){let{open:s=!1}=t,{myKeyPair:i}=t,{providerUrl:a=""}=t,{apiKey:o=""}=t;const r=be();new Se(r.channelId,r.addressA,r.addressB,r.initialBalanceA,r.initialBalanceB,r.isA,i,r.hisPublicKey,o,a);let c="";return e.$$set=e=>{"open"in e&&n(0,s=e.open),"myKeyPair"in e&&n(2,i=e.myKeyPair),"providerUrl"in e&&n(3,a=e.providerUrl),"apiKey"in e&&n(4,o=e.apiKey)},[s,c,i,a,o,()=>{try{n(1,c="")}catch(e){n(1,c="ERROR")}}]}class Ye extends ge{constructor(e){super(),fe(this,e,Ge,je,r,{open:0,myKeyPair:2,providerUrl:3,apiKey:4})}}function Je(e){let t;return{c(){t=x("Confirm")},m(e,n){A(e,t,n)},d(e){e&&C(t)}}}function Qe(e){let t,n,s,i,a,o,r,c,l,d;function u(t){e[4](t)}let h={};return void 0!==e[2]&&(h.value=e[2]),s=new xe({props:h}),F.push((()=>he(s,"value",u))),s.$on("keypress",e[5]),o=new Ae({props:{wide:!0,type:"accent",$$slots:{default:[Je]},$$scope:{ctx:e}}}),o.$on("keypress",e[6]),o.$on("click",e[7]),{c(){t=P("h2"),t.textContent="Enter your password",n=I(),pe(s.$$.fragment),a=I(),pe(o.$$.fragment),r=I(),c=P("div"),l=x(e[3]),k(c,"class","error")},m(e,i){A(e,t,i),A(e,n,i),me(s,e,i),A(e,a,i),me(o,e,i),A(e,r,i),A(e,c,i),b(c,l),d=!0},p(e,t){const n={};!i&&4&t&&(i=!0,n.value=e[2],Q((()=>i=!1))),s.$set(n);const a={};256&t&&(a.$$scope={dirty:t,ctx:e}),o.$set(a),(!d||8&t)&&_(l,e[3])},i(e){d||(ce(s.$$.fragment,e),ce(o.$$.fragment,e),d=!0)},o(e){le(s.$$.fragment,e),le(o.$$.fragment,e),d=!1},d(e){e&&C(t),e&&C(n),we(s,e),e&&C(a),we(o,e),e&&C(r),e&&C(c)}}}function Xe(e){let t,n;return t=new Fe({props:{open:e[1],$$slots:{default:[Qe]},$$scope:{ctx:e}}}),{c(){pe(t.$$.fragment)},m(e,s){me(t,e,s),n=!0},p(e,[n]){const s={};2&n&&(s.open=e[1]),269&n&&(s.$$scope={dirty:n,ctx:e}),t.$set(s)},i(e){n||(ce(t.$$.fragment,e),n=!0)},o(e){le(t.$$.fragment,e),n=!1},d(e){we(t,e)}}}function Ze(e,t,n){let{confirmPassword:s}=t,{open:i=!1}=t,a="",o="";return e.$$set=e=>{"confirmPassword"in e&&n(0,s=e.confirmPassword),"open"in e&&n(1,i=e.open)},[s,i,a,o,function(e){a=e,n(2,a)},e=>{"Enter"===e.key&&(e.preventDefault(),s(a))},e=>{"Enter"===e.key&&(e.preventDefault(),s(a))},()=>{try{s(a),n(3,o="")}catch(e){n(3,o="ERROR")}}]}class et extends ge{constructor(e){super(),fe(this,e,Ze,Xe,r,{confirmPassword:0,open:1})}}const tt=TonWeb.utils.BN,nt=TonWeb.utils.nacl,st=TonWeb.utils.Address,it=TonWeb.utils.fromNano;let at=-1,ot=new Set,rt=null;const ct=[];let lt=null;const dt=()=>new Promise((async e=>{if(at>-1)return chrome.windows.update(at,{focused:!0}),e();const t=await ye.getItem("windowState")||{};t.top=t.top||0,t.left=t.left||0,t.height=t.height||800,t.width=t.width||480,chrome.windows.create(Object.assign(t,{url:"index.html",type:"popup",focused:!0}),(t=>{at=t.id,e()}))}));const ut=!!(self.chrome&&chrome.runtime&&chrome.runtime.onConnect),ht="v3R2";class pt{constructor(){this.isTestnet=!1,this.isDebug=!1,this.myAddress=null,this.publicKeyHex=null,this.myMnemonicWords=null,this.balance=null,this.walletContract=null,this.transactions=[],this.updateIntervalId=0,this.lastTransactionTime=0,this.isContractInitialized=!1,this.sendingData=null,this.processingVisible=!1,this.ledgerApp=null,this.isLedger=!1,self.view&&(self.view.controller=this),this.pendingMessageResolvers=new Map,this._lastMsgId=1,this.whenReady=this._init()}debug(...e){this.isDebug&&console.log(...e)}static async wordsToPrivateKey(e){const t=await TonWeb.mnemonic.mnemonicToKeyPair(e);return TonWeb.utils.bytesToBase64(t.secretKey.slice(0,32))}static async saveWords(e,t){await ye.setItem("words",await async function(e,t){const n=(new TextEncoder).encode(t),s=await crypto.subtle.digest("SHA-256",n),i=crypto.getRandomValues(new Uint8Array(12)),a={name:"AES-GCM",iv:i},o=await crypto.subtle.importKey("raw",s,a,!1,["encrypt"]),r=(new TextEncoder).encode(e),c=await crypto.subtle.encrypt(a,o,r),l=Array.from(new Uint8Array(c)).map((e=>String.fromCharCode(e))).join(""),d=btoa(l);return Array.from(i).map((e=>("00"+e.toString(16)).slice(-2))).join("")+d}(e.join(","),t))}static async loadWords(e){return(await async function(e,t){const n=(new TextEncoder).encode(t),s=await crypto.subtle.digest("SHA-256",n),i=e.slice(0,24).match(/.{2}/g).map((e=>parseInt(e,16))),a={name:"AES-GCM",iv:new Uint8Array(i)},o=await crypto.subtle.importKey("raw",s,a,!1,["decrypt"]),r=atob(e.slice(24)),c=new Uint8Array(r.match(/[\s\S]/g).map((e=>e.charCodeAt(0)))),l=await crypto.subtle.decrypt(a,o,c);return(new TextDecoder).decode(l)}(await ye.getItem("words"),e)).split(",")}async getWallet(){return this.ton.provider.getWalletInfo(this.myAddress)}checkContractInitialized(e){return"active"===e.account_state}getBalance(e){return new tt(e.balance)}async _init(){return new Promise((async e=>{await ye.removeItem("pwdHash"),this.isTestnet=ut?await ye.getItem("isTestnet"):self.location.href.indexOf("testnet")>-1,this.isDebug=ut?await ye.getItem("isDebug"):self.location.href.indexOf("debug")>-1;const t=this.isTestnet?TONCENTER_API_KEY_WEB_TEST:TONCENTER_API_KEY_WEB_MAIN,n=this.isTestnet?TONCENTER_API_KEY_EXT_TEST:TONCENTER_API_KEY_EXT_MAIN;ut&&!await ye.getItem("address")&&await this._restoreDeprecatedStorage(),this.ton=new TonWeb(new TonWeb.HttpProvider(this.isTestnet?"https://testnet.toncenter.com/api/v2/jsonRPC":"https://toncenter.com/api/v2/jsonRPC",{apiKey:ut?n:t})),this.myAddress=await ye.getItem("address"),this.publicKeyHex=await ye.getItem("publicKey"),this.myAddress&&await ye.getItem("words")?("true"===await ye.getItem("isLedger")&&(this.isLedger=!0,this.sendToView("setIsLedger",this.isLedger)),await this.showMain()):(await ye.clear(),this.sendToView("showScreen",{name:"start",noAnimation:!0})),this.sendToView("setIsTestnet",this.isTestnet),e()}))}async _restoreDeprecatedStorage(){const{address:e,words:t,walletVersion:n,magic:s,proxy:i}=await this.sendToView("restoreDeprecatedStorage",void 0,!0,!0);e&&t&&await Promise.all([ye.setItem("address",e),ye.setItem("words",t),ye.setItem("walletVersion",n),ye.setItem("magic",s),ye.setItem("proxy",i)])}async toggleTestnet(){this.isTestnet=!this.isTestnet,this.isTestnet?await ye.setItem("isTestnet","true"):await ye.removeItem("isTestnet"),this.clearVars(),await this._init(),await this.sendToView("setIsTestnet",this.isTestnet)}async toggleDebug(){this.isDebug=!this.isDebug,this.isDebug?await ye.setItem("isDebug","true"):await ye.removeItem("isDebug")}async getTransactions(e=20){function t(e){if(!e.msg_data)return"";if("msg.dataText"!==e.msg_data["@type"])return"";const t=e.msg_data.text;return(new TextDecoder).decode(TonWeb.utils.base64ToBytes(t))}const n=[],s=await this.ton.getTransactions(this.myAddress,e);for(let e of s){let s=new tt(e.in_msg.value);for(let t of e.out_msgs)s=s.sub(new tt(t.value));let i="",a="",o="";e.in_msg.source?(i=e.in_msg.source,a=e.in_msg.destination,o=t(e.in_msg)):e.out_msgs.length&&(i=e.out_msgs[0].source,a=e.out_msgs[0].destination,o=t(e.out_msgs[0])),a&&n.push({amount:s.toString(),from_addr:i,to_addr:a,fee:e.fee.toString(),storageFee:e.storage_fee.toString(),otherFee:e.other_fee.toString(),comment:o,date:1e3*e.utime})}return n}async sign(e,t,n,s,i){let a=(await this.getWallet(this.myAddress)).seqno;a||(a=0);const o=s?s.secretKey:null;return this.walletContract.methods.transfer({secretKey:o,toAddress:e,amount:t,seqno:a,payload:n,sendMode:3,stateInit:i})}async showCreated(){this.sendToView("showScreen",{name:"created"}),this.sendToView("disableCreated",!0),this.myMnemonicWords=await TonWeb.mnemonic.generateMnemonic();const e=await pt.wordsToPrivateKey(this.myMnemonicWords),t=nt.sign.keyPair.fromSeed(TonWeb.utils.base64ToBytes(e)),n=ht,s=this.ton.wallet.all.v3R2;this.walletContract=new s(this.ton.provider,{publicKey:t.publicKey,wc:0}),this.myAddress=(await this.walletContract.getAddress()).toString(!0,!0,!0),this.publicKeyHex=TonWeb.utils.bytesToHex(t.publicKey),await ye.setItem("publicKey",this.publicKeyHex),await ye.setItem("walletVersion",n),this.sendToView("disableCreated",!1)}async createPrivateKey(){this.showBackup(this.myMnemonicWords,!0)}onBackupWalletClick(){this.afterEnterPassword=async e=>{this.showBackup(e)},this.sendToView("showPopup",{name:"enterPassword"})}showBackup(e,t){this.sendToView("showScreen",{name:"backup",words:e,isFirst:t})}async onBackupDone(){await ye.getItem("words")?this.sendToView("showScreen",{name:"main"}):this.sendToView("showScreen",{name:"wordsConfirm",words:this.myMnemonicWords})}onConfirmDone(e){if(e){let t=!0;if(Object.keys(e).forEach((n=>{this.myMnemonicWords[n]!==e[n]&&(t=!1)})),!t)return;this.showCreatePassword()}}async createLedger(e){let t;switch(e){case"hid":t=await TonWeb.ledger.TransportWebHID.create();break;case"ble":t=await TonWeb.ledger.BluetoothTransport.create();break;default:throw new Error("unknown transportType"+e)}t.setDebugMode(!0),this.isLedger=!0,this.ledgerApp=new TonWeb.ledger.AppTon(t,this.ton);const n=(await this.ledgerApp.getAppConfiguration()).version;if(this.debug("ledgerAppConfig=",n),!n.startsWith("2"))throw alert("Please update your Ledger TON-app to v2.0.1 or upper or use old wallet version https://tonwallet.me/prev/"),new Error("outdated ledger ton-app version");const{publicKey:s}=await this.ledgerApp.getPublicKey(0,!1),i=new(0,this.ton.wallet.all.v3R1)(this.ton.provider,{publicKey:s,wc:0});this.walletContract=i;const a=await i.getAddress();this.myAddress=a.toString(!0,!0,!0),this.publicKeyHex=TonWeb.utils.bytesToHex(s)}async importLedger(e){await this.createLedger(e),await ye.setItem("walletVersion",this.walletContract.getName()),await ye.setItem("address",this.myAddress),await ye.setItem("isLedger","true"),await ye.setItem("ledgerTransportType",e),await ye.setItem("words","ledger"),await ye.setItem("publicKey",this.publicKeyHex),this.sendToView("setIsLedger",this.isLedger),this.sendToView("showScreen",{name:"readyToGo"})}showImport(){this.sendToView("showScreen",{name:"import"})}async import(e){if(this.myMnemonicWords=e,this.myMnemonicWords)try{const e=await pt.wordsToPrivateKey(this.myMnemonicWords),t=nt.sign.keyPair.fromSeed(TonWeb.utils.base64ToBytes(e));let n=[];for(let e of this.ton.wallet.list){const s=new e(this.ton.provider,{publicKey:t.publicKey,wc:0}),i=(await s.getAddress()).toString(!0,!0,!0),a=await this.ton.provider.getWalletInfo(i),o=this.getBalance(a);o.gt(new tt(0))&&n.push({balance:o,clazz:e}),this.debug(s.getName(),i,a,o.toString())}let s=this.ton.wallet.all.v3R2;n.length>0&&(n.sort(((e,t)=>e.balance.cmp(t.balance))),s=n[n.length-1].clazz),await this.importImpl(t,s),this.sendToView("importCompleted",{state:"success"})}catch(e){this.debug(e),this.sendToView("importCompleted",{state:"failure"})}else this.sendToView("importCompleted",{state:"failure"})}async importImpl(e,t){this.walletContract=new t(this.ton.provider,{publicKey:e.publicKey,wc:0}),this.myAddress=(await this.walletContract.getAddress()).toString(!0,!0,!0),this.publicKeyHex=TonWeb.utils.bytesToHex(e.publicKey),await ye.setItem("publicKey",this.publicKeyHex),await ye.setItem("walletVersion",this.walletContract.getName()),this.showCreatePassword()}showCreatePassword(){this.sendToView("showScreen",{name:"createPassword"})}async savePrivateKey(e){this.isLedger=!1,await ye.setItem("isLedger","false"),await ye.setItem("address",this.myAddress),await pt.saveWords(this.myMnemonicWords,e),this.myMnemonicWords=null,this.sendToView("setIsLedger",this.isLedger),this.sendToView("showScreen",{name:"readyToGo"}),this.sendToView("privateKeySaved")}async onChangePassword(e,t){let n;try{n=await pt.loadWords(e)}catch(e){return void this.sendToView("showChangePasswordError")}await pt.saveWords(n,t),this.sendToView("closePopup"),this.sendToView("passwordChanged")}async onEnterPassword(e){let t;try{t=await pt.loadWords(e)}catch(e){return void this.sendToView("showEnterPasswordError")}this.afterEnterPassword(t),this.sendToView("passwordEntered")}async showMain(){if(this.sendToView("showScreen",{name:"main",myAddress:this.myAddress}),!this.walletContract){const e=await ye.getItem("walletVersion"),t=e?this.ton.wallet.all[e]:this.ton.wallet.default;this.walletContract=new t(this.ton.provider,{address:this.myAddress,publicKey:this.publicKeyHex?TonWeb.utils.hexToBytes(this.publicKeyHex):void 0,wc:0})}this.updateIntervalId=setInterval((()=>this.update()),5e3),this.update(!0),this.sendToDapp("ton_accounts",[this.myAddress])}async initDapp(){this.sendToDapp("ton_accounts",this.myAddress?[this.myAddress]:[]),this.doMagic("true"===await ye.getItem("magic")),this.doProxy("true"===await ye.getItem("proxy"))}async initView(){this.myAddress&&await ye.getItem("words")?(this.sendToView("showScreen",{name:"main",myAddress:this.myAddress}),null!==this.balance&&this.sendToView("setBalance",{balance:this.balance.toString(),txs:this.transactions})):this.sendToView("showScreen",{name:"start",noAnimation:!0}),this.sendToView("setIsMagic","true"===await ye.getItem("magic")),this.sendToView("setIsProxy","true"===await ye.getItem("proxy")),this.sendToView("setIsTestnet",this.isTestnet)}async update(e){if(!(this.processingVisible&&this.sendingData||null===this.balance||e))return;const t=await this.getWallet(),n=this.getBalance(t),s=null===this.balance||0!==this.balance.cmp(n);this.balance=n;const i=this.checkContractInitialized(t)&&t.seqno;this.debug("isBalanceChanged",s),this.debug("isContractInitialized",i),!this.isContractInitialized&&i&&(this.isContractInitialized=!0),s?this.getTransactions().then((e=>{if(e.length>0){this.transactions=e;const t=e.filter((e=>Number(e.date)>this.lastTransactionTime));if(this.lastTransactionTime=Number(e[0].date),this.processingVisible&&this.sendingData)for(let e of t){const t=new st(e.to_addr).toString(!0,!0,!0),n=new st(this.sendingData.toAddress).toString(!0,!0,!0),s=e.amount,i="-"+this.sendingData.amount.toString();if(t===n&&s===i){this.sendToView("showPopup",{name:"done",message:it(this.sendingData.amount)+" TON have been sent"}),this.processingVisible=!1,this.sendingData=null;break}}}this.sendToView("setBalance",{balance:n.toString(),txs:e})})):this.sendToView("setBalance",{balance:n.toString(),txs:this.transactions})}async showAddressOnDevice(){this.ledgerApp||await this.createLedger(await ye.getItem("ledgerTransportType")||"hid");const{address:e}=await this.ledgerApp.getAddress(0,!0,this.ledgerApp.ADDRESS_FORMAT_USER_FRIENDLY+this.ledgerApp.ADDRESS_FORMAT_URL_SAFE+this.ledgerApp.ADDRESS_FORMAT_BOUNCEABLE);this.debug(e.toString(!0,!0,!0))}async getFees(e,t,n,s){if(!this.isContractInitialized&&!this.publicKeyHex)return TonWeb.utils.toNano("0.010966001");const i=await this.sign(t,e,n,null,s),a=(await i.estimateFee()).source_fees,o=new tt(a.in_fwd_fee),r=new tt(a.storage_fee),c=new tt(a.gas_fee),l=new tt(a.fwd_fee);return o.add(r).add(c).add(l)}async showSendConfirm(e,t,n,s,i){if((()=>{let e,t;lt&&lt.resolve(!1),lt=new Promise(((n,s)=>{e=n,t=s})),lt.resolve=(...t)=>{e(...t),lt=null},lt.reject=(...e)=>{t(...e),lt=null}})(),!e.gt(new tt(0)))return this.sendToView("sendCheckFailed",{message:"Invalid amount"}),!1;if(!st.isValid(t))try{if(t=t.toLowerCase(),this.isTestnet&&t.endsWith(".ton")){if(!(t=await this.ton.dns.getWalletAddress(t)))throw new Error;if(!st.isValid(t))throw new Error;t=t.toString(!0,!0,!0)}}catch(e){return this.sendToView("sendCheckFailed",{message:"Invalid address or domain"}),!1}try{await this.update(!0)}catch{return this.sendToView("sendCheckFailed",{message:"API request error"}),!1}if(this.balance.lt(e))return this.sendToView("sendCheckFailed",{message:"Not enough balance"}),!1;let a;try{a=await this.getFees(e,t,n,i)}catch{return this.sendToView("sendCheckFailed",{message:"API request error"}),!1}if(this.balance.sub(a).lt(e))return this.sendToView("sendCheckCantPayFee",{fee:a}),!1;if(this.isLedger){this.sendToView("showPopup",{name:"sendConfirm",amount:e.toString(),toAddress:t,fee:a.toString()},s);await this.send(t,e,n,null,i)?lt.resolve(!0):(this.sendToView("sendCheckFailed",{message:"API request error"}),lt.resolve(!1))}else this.afterEnterPassword=async s=>{this.processingVisible=!0,this.sendToView("showPopup",{name:"processing"});const a=await pt.wordsToPrivateKey(s);await this.send(t,e,n,a,i)?lt.resolve(!0):(this.sendToView("sendCheckFailed",{message:"API request error"}),lt.resolve(!1))},this.onCancelAction=()=>{lt.resolve(!1)},this.sendToView("showPopup",{name:"sendConfirm",amount:e.toString(),toAddress:t,fee:a.toString()},s);return this.sendToView("sendCheckSucceeded"),lt||!1}showSignConfirm(e,t){return new Promise(((n,s)=>{this.isLedger?(alert("sign not supported by Ledger"),s()):(this.afterEnterPassword=async t=>{this.sendToView("closePopup");const s=await pt.wordsToPrivateKey(t),i=this.rawSign(e,s);n(i)},this.sendToView("showPopup",{name:"signConfirm",data:e},t))}))}async send(e,t,n,s,i){try{let a=0;if(this.isLedger){if(i)throw new Error("stateInit dont supported by Ledger");this.ledgerApp||await this.createLedger(await ye.getItem("ledgerTransportType")||"hid");const t=new st(e);t.isUserFriendly&&(a+=this.ledgerApp.ADDRESS_FORMAT_USER_FRIENDLY,t.isUrlSafe&&(a+=this.ledgerApp.ADDRESS_FORMAT_URL_SAFE),t.isBounceable&&(a+=this.ledgerApp.ADDRESS_FORMAT_BOUNCEABLE),t.isTestOnly&&(a+=this.ledgerApp.ADDRESS_FORMAT_TEST_ONLY))}if(this.checkContractInitialized(await this.ton.provider.getWalletInfo(e))||(e=new st(e).toString(!0,!0,!1)),this.isLedger){let s=(await this.getWallet(this.myAddress)).seqno;s||(s=0);const i=await this.ledgerApp.transfer(0,this.walletContract,e,t,s,a);return this.sendingData={toAddress:e,amount:t,comment:n,query:i},this.sendToView("showPopup",{name:"processing"}),this.processingVisible=!0,await this.sendQuery(i)}{const a=nt.sign.keyPair.fromSeed(TonWeb.utils.base64ToBytes(s)),o=await this.sign(e,t,n,a,i);return this.sendingData={toAddress:e,amount:t,comment:n,query:o},await this.sendQuery(o)}}catch(e){return this.debug(e),this.sendToView("closePopup"),alert("Error sending"),!1}}rawSign(e,t){const n=nt.sign.keyPair.fromSeed(TonWeb.utils.base64ToBytes(t)),s=nt.sign.detached(TonWeb.utils.hexToBytes(e),n.secretKey);return TonWeb.utils.bytesToHex(s)}async sendQuery(e){return"ok"===(await e.send())["@type"]||(this.sendToView("closePopup"),alert("Send error"),!1)}clearVars(){this.myAddress=null,this.publicKeyHex=null,this.balance=null,this.walletContract=null,this.transactions=[],this.lastTransactionTime=0,this.isContractInitialized=!1,this.sendingData=null,this.processingVisible=!1,this.isLedger=!1,this.ledgerApp=null,clearInterval(this.updateIntervalId)}async onDisconnectClick(){this.clearVars(),await ye.clear(),this.sendToView("showScreen",{name:"start"}),this.sendToDapp("ton_accounts",[])}doMagic(e){try{this.sendToDapp("ton_doMagic",e)}catch(e){}}doProxy(e){}sendToView(e,t,n,s){if(!self.view){const i={method:e,params:t},a=()=>{rt?rt.postMessage(i):n&&ct.push(i)};return s?new Promise((e=>{i.id=this._lastMsgId++,this.pendingMessageResolvers.set(i.id,e),a()})):void a()}{const n=self.view.onMessage(e,t);if(s)return n}}async onViewMessage(e,t){switch(e){case"showScreen":switch(t.name){case"created":await this.showCreated();break;case"import":this.showImport();break;case"importLedger":await this.importLedger(t.transportType)}break;case"import":await this.import(t.words);break;case"createPrivateKey":await this.createPrivateKey();break;case"passwordCreated":await this.savePrivateKey(t.password);break;case"update":this.update(!0);break;case"showAddressOnDevice":await this.showAddressOnDevice();break;case"onCancelAction":this.onCancelAction&&(await this.onCancelAction(),this.onCancelAction=null);break;case"onEnterPassword":await this.onEnterPassword(t.password);break;case"onChangePassword":await this.onChangePassword(t.oldPassword,t.newPassword);break;case"onSend":await this.showSendConfirm(new tt(t.amount),t.toAddress,t.comment);break;case"onBackupDone":await this.onBackupDone();break;case"onConfirmBack":this.showBackup(this.myMnemonicWords);break;case"onImportBack":this.sendToView("showScreen",{name:"start"});break;case"onConfirmDone":this.onConfirmDone(t.words);break;case"showMain":await this.showMain();break;case"onBackupWalletClick":this.onBackupWalletClick();break;case"disconnect":await this.onDisconnectClick();break;case"onClosePopup":this.processingVisible=!1;break;case"onMagicClick":await ye.setItem("magic",t?"true":"false"),this.doMagic(t);break;case"onProxyClick":await ye.setItem("proxy",t?"true":"false"),this.doProxy(t);break;case"toggleTestnet":await this.toggleTestnet();break;case"toggleDebug":await this.toggleDebug();break;case"onWindowUpdate":await ye.setItem("windowState",{top:t.top,left:t.left,height:t.height-2,width:t.width-2})}}sendToDapp(e,t){ot.forEach((n=>{n.postMessage(JSON.stringify({type:"gramWalletAPI",message:{jsonrpc:"2.0",method:e,params:t}}))}))}requestPublicKey(e){return new Promise((async(t,n)=>{await dt(),this.afterEnterPassword=async e=>{const n=await pt.wordsToPrivateKey(e),s=nt.sign.keyPair.fromSeed(TonWeb.utils.base64ToBytes(n));this.publicKeyHex=TonWeb.utils.bytesToHex(s.publicKey),await ye.setItem("publicKey",this.publicKeyHex),t()},this.sendToView("showPopup",{name:"enterPassword"},e)}))}async onDappMessage(e,t){await this.whenReady;const n=!rt;switch(e){case"ton_requestAccounts":return this.myAddress?[this.myAddress]:[];case"ton_requestWallets":if(!this.myAddress)return[];this.publicKeyHex||await this.requestPublicKey(n);const e=await ye.getItem("walletVersion");return[{address:this.myAddress,publicKey:this.publicKeyHex,walletVersion:e}];case"ton_getBalance":return await this.update(!0),this.balance?this.balance.toString():"";case"ton_sendTransaction":const s=t[0];await dt(),s.data&&("hex"===s.dataType?s.data=TonWeb.utils.hexToBytes(s.data):"base64"===s.dataType?s.data=TonWeb.utils.base64ToBytes(s.data):"boc"===s.dataType&&(s.data=TonWeb.boc.Cell.oneFromBoc(TonWeb.utils.base64ToBytes(s.data)))),s.stateInit&&(s.stateInit=TonWeb.boc.Cell.oneFromBoc(TonWeb.utils.base64ToBytes(s.stateInit))),this.sendToView("showPopup",{name:"loader"});const i=await this.showSendConfirm(new tt(s.value),s.to,s.data,n,s.stateInit);return i||this.sendToView("closePopup"),i;case"ton_rawSign":const a=t[0];return await dt(),this.showSignConfirm(a.data,n);case"flushMemoryCache":return await chrome.webRequest.handlerBehaviorChanged(),!0}}}const mt=new pt;if(ut){chrome.runtime.onConnect.addListener((e=>{if("gramWalletContentScript"===e.name)ot.add(e),e.onMessage.addListener((async(e,t)=>{if("gramWalletAPI_ton_provider_connect"===e.type&&mt.whenReady.then((()=>{mt.initDapp()})),!e.message)return;const n=await mt.onDappMessage(e.message.method,e.message.params);t&&t.postMessage(JSON.stringify({type:"gramWalletAPI",message:{jsonrpc:"2.0",id:e.message.id,method:e.message.method,result:n}}))})),e.onDisconnect.addListener((e=>{ot.delete(e)}));else if("gramWalletPopup"===e.name){rt=e,rt.onMessage.addListener((function(e){if("response"===e.method){const t=mt.pendingMessageResolvers.get(e.id);t&&(t(e.result),mt.pendingMessageResolvers.delete(e.id))}else mt.onViewMessage(e.method,e.params)})),rt.onDisconnect.addListener((()=>{rt=null}));const t=()=>{ct.forEach((e=>rt.postMessage(e))),ct.length=0};mt.myAddress||t(),mt.whenReady.then((async()=>{await mt.initView(),t()}))}}));let e="action";2===chrome.runtime.getManifest().manifest_version&&(e="browserAction"),chrome[e].onClicked.addListener(dt),chrome.windows.onRemoved.addListener((e=>{lt&&lt.resolve(!1),e===at&&(at=-1)}))}function wt(e,t,n){const s=e.slice();return s[32]=t[n],s[34]=n,s}function ft(e){let t,n,s,i;const a=[bt,$t,yt],o=[];function r(e,t){return 1==e[11]?0:2==e[11]?1:2}return n=r(e),s=o[n]=a[n](e),{c(){t=P("div"),s.c(),k(t,"class","create-box svelte-dk41iq")},m(e,s){A(e,t,s),o[n].m(t,null),i=!0},p(e,i){let c=n;n=r(e),n===c?o[n].p(e,i):(oe(),le(o[c],1,1,(()=>{o[c]=null})),re(),s=o[n],s?s.p(e,i):(s=o[n]=a[n](e),s.c()),ce(s,1),s.m(t,null))},i(e){i||(ce(s),i=!0)},o(e){le(s),i=!1},d(e){e&&C(t),o[n].d()}}}function gt(e){let t,n,s,i,a,o,r,c,l,d,u,h,p,m,w,f,g,y,$,T=$e(e[7])+"",v=e[0]&&Pt(),E=e[10]&&xt(e);const K=[St,It],W=[];function V(e,t){return e[10]?0:1}return p=V(e),m=W[p]=K[p](e),f=new Ae({props:{type:"default",wide:!0,$$slots:{default:[Et]},$$scope:{ctx:e}}}),f.$on("click",e[22]),{c(){t=P("div"),n=P("p"),s=x("wallet: "),i=x(T),a=I(),o=P("i"),v&&v.c(),r=I(),c=P("p"),l=x("balance: "),d=x(e[8]),u=I(),E&&E.c(),h=I(),m.c(),w=I(),pe(f.$$.fragment),k(o,"class","fa-solid fa-copy"),k(n,"class","info svelte-dk41iq"),k(c,"class","info svelte-dk41iq"),k(t,"class","info-box svelte-dk41iq")},m(m,T){A(m,t,T),b(t,n),b(n,s),b(n,i),b(n,a),b(n,o),v&&v.m(n,null),b(t,r),b(t,c),b(c,l),b(c,d),A(m,u,T),E&&E.m(m,T),A(m,h,T),W[p].m(m,T),A(m,w,T),me(f,m,T),g=!0,y||($=S(o,"click",e[17]),y=!0)},p(e,t){(!g||128&t[0])&&T!==(T=$e(e[7])+"")&&_(i,T),e[0]?v||(v=Pt(),v.c(),v.m(n,null)):v&&(v.d(1),v=null),(!g||256&t[0])&&_(d,e[8]),e[10]?E?(E.p(e,t),1024&t[0]&&ce(E,1)):(E=xt(e),E.c(),ce(E,1),E.m(h.parentNode,h)):E&&(oe(),le(E,1,1,(()=>{E=null})),re());let s=p;p=V(e),p===s?W[p].p(e,t):(oe(),le(W[s],1,1,(()=>{W[s]=null})),re(),m=W[p],m?m.p(e,t):(m=W[p]=K[p](e),m.c()),ce(m,1),m.m(w.parentNode,w));const a={};16&t[1]&&(a.$$scope={dirty:t,ctx:e}),f.$set(a)},i(e){g||(ce(E),ce(m),ce(f.$$.fragment,e),g=!0)},o(e){le(E),le(m),le(f.$$.fragment,e),g=!1},d(e){e&&C(t),v&&v.d(),e&&C(u),E&&E.d(e),e&&C(h),W[p].d(e),e&&C(w),we(f,e),y=!1,$()}}}function yt(e){let t,n,s,i,a,o,r,c,l,d,u,h,p=e[1],m=[];for(let t=0;t<p.length;t+=1)m[t]=Tt(wt(e,p,t));function w(t){e[25](t)}let f={class:"create"};return void 0!==e[2]&&(f.value=e[2]),c=new xe({props:f}),F.push((()=>he(c,"value",w))),c.$on("keypress",e[26]),u=new Ae({props:{type:"accent",wide:!0,$$slots:{default:[vt]},$$scope:{ctx:e}}}),u.$on("click",e[14]),{c(){t=P("h2"),n=P("h2"),n.textContent="Your phrase is:",s=I(),i=P("div");for(let e=0;e<m.length;e+=1)m[e].c();a=I(),o=P("h2"),o.textContent="Please save phrase and setup your Pin-code and continue:",r=I(),pe(c.$$.fragment),d=I(),pe(u.$$.fragment),k(i,"class","phrase svelte-dk41iq")},m(e,l){A(e,t,l),b(t,n),b(t,s),b(t,i);for(let e=0;e<m.length;e+=1)m[e].m(i,null);A(e,a,l),A(e,o,l),A(e,r,l),me(c,e,l),A(e,d,l),me(u,e,l),h=!0},p(e,t){if(2&t[0]){let n;for(p=e[1],n=0;n<p.length;n+=1){const s=wt(e,p,n);m[n]?m[n].p(s,t):(m[n]=Tt(s),m[n].c(),m[n].m(i,null))}for(;n<m.length;n+=1)m[n].d(1);m.length=p.length}const n={};!l&&4&t[0]&&(l=!0,n.value=e[2],Q((()=>l=!1))),c.$set(n);const s={};16&t[1]&&(s.$$scope={dirty:t,ctx:e}),u.$set(s)},i(e){h||(ce(c.$$.fragment,e),ce(u.$$.fragment,e),h=!0)},o(e){le(c.$$.fragment,e),le(u.$$.fragment,e),h=!1},d(e){e&&C(t),function(e,t){for(let n=0;n<e.length;n+=1)e[n]&&e[n].d(t)}(m,e),e&&C(a),e&&C(o),e&&C(r),we(c,e),e&&C(d),we(u,e)}}}function $t(e){let t,n,s,i,a,o;return a=new Ae({props:{wide:!0,type:"accent",$$slots:{default:[At]},$$scope:{ctx:e}}}),a.$on("click",e[24]),{c(){t=P("h2"),t.textContent="To create a wallet need to generate and write down a seed phrase.",n=I(),s=P("p"),s.textContent="Please memorize the phrase and keep it in a safe place.",i=I(),pe(a.$$.fragment)},m(e,r){A(e,t,r),A(e,n,r),A(e,s,r),A(e,i,r),me(a,e,r),o=!0},p(e,t){const n={};16&t[1]&&(n.$$scope={dirty:t,ctx:e}),a.$set(n)},i(e){o||(ce(a.$$.fragment,e),o=!0)},o(e){le(a.$$.fragment,e),o=!1},d(e){e&&C(t),e&&C(n),e&&C(s),e&&C(i),we(a,e)}}}function bt(e){let t,n,s,i;return s=new Ae({props:{wide:!0,type:"accent",$$slots:{default:[Ct]},$$scope:{ctx:e}}}),s.$on("click",e[23]),{c(){t=P("h2"),t.textContent="Welcome to the open wallet",n=I(),pe(s.$$.fragment)},m(e,a){A(e,t,a),A(e,n,a),me(s,e,a),i=!0},p(e,t){const n={};16&t[1]&&(n.$$scope={dirty:t,ctx:e}),s.$set(n)},i(e){i||(ce(s.$$.fragment,e),i=!0)},o(e){le(s.$$.fragment,e),i=!1},d(e){e&&C(t),e&&C(n),we(s,e)}}}function Tt(e){let t,n,s,i,a,o=e[34]+1+"",r=e[32]+"";return{c(){t=P("span"),n=x(o),s=x("."),i=x(r),a=I(),k(t,"class","word svelte-dk41iq")},m(e,o){A(e,t,o),b(t,n),b(t,s),b(t,i),b(t,a)},p(e,t){2&t[0]&&r!==(r=e[32]+"")&&_(i,r)},d(e){e&&C(t)}}}function vt(e){let t;return{c(){t=x("Save pincode")},m(e,n){A(e,t,n)},d(e){e&&C(t)}}}function At(e){let t;return{c(){t=x("Generate phrase")},m(e,n){A(e,t,n)},d(e){e&&C(t)}}}function Ct(e){let t;return{c(){t=x("Create Wallet")},m(e,n){A(e,t,n)},d(e){e&&C(t)}}}function Pt(e){let t;return{c(){t=P("span"),t.textContent="Copied!"},m(e,n){A(e,t,n)},d(e){e&&C(t)}}}function xt(e){let t,n,s,i,a;function o(t){e[18](t)}let r={class:"input"};return void 0!==e[2]&&(r.value=e[2]),s=new xe({props:r}),F.push((()=>he(s,"value",o))),s.$on("change",e[19]),{c(){t=P("h2"),t.textContent="Change Pin-Code",n=I(),pe(s.$$.fragment)},m(e,i){A(e,t,i),A(e,n,i),me(s,e,i),a=!0},p(e,t){const n={};!i&&4&t[0]&&(i=!0,n.value=e[2],Q((()=>i=!1))),s.$set(n)},i(e){a||(ce(s.$$.fragment,e),a=!0)},o(e){le(s.$$.fragment,e),a=!1},d(e){e&&C(t),e&&C(n),we(s,e)}}}function It(e){let t,n;return t=new Ae({props:{wide:!0,type:"accent",$$slots:{default:[kt]},$$scope:{ctx:e}}}),t.$on("click",e[21]),{c(){pe(t.$$.fragment)},m(e,s){me(t,e,s),n=!0},p(e,n){const s={};16&n[1]&&(s.$$scope={dirty:n,ctx:e}),t.$set(s)},i(e){n||(ce(t.$$.fragment,e),n=!0)},o(e){le(t.$$.fragment,e),n=!1},d(e){we(t,e)}}}function St(e){let t,n;return t=new Ae({props:{wide:!0,type:"accent",$$slots:{default:[_t]},$$scope:{ctx:e}}}),t.$on("click",e[20]),{c(){pe(t.$$.fragment)},m(e,s){me(t,e,s),n=!0},p(e,n){const s={};16&n[1]&&(s.$$scope={dirty:n,ctx:e}),t.$set(s)},i(e){n||(ce(t.$$.fragment,e),n=!0)},o(e){le(t.$$.fragment,e),n=!1},d(e){we(t,e)}}}function kt(e){let t;return{c(){t=x("Change Pin-Code")},m(e,n){A(e,t,n)},d(e){e&&C(t)}}}function _t(e){let t;return{c(){t=x("Confirm Pin-Code")},m(e,n){A(e,t,n)},d(e){e&&C(t)}}}function Et(e){let t;return{c(){t=x("Delete Wallet")},m(e,n){A(e,t,n)},d(e){e&&C(t)}}}function Kt(e){let t,n,s,i,a,o,r,c,l,d,u;const h=[gt,ft],p=[];function m(e,t){return"LOGIN"==e[9]?0:1}return a=m(e),o=p[a]=h[a](e),c=new Ye({props:{apiKey:Vt,providerUrl:Wt,myKeyPair:e[6],open:e[4]}}),d=new et({props:{confirmPassword:e[15],open:e[3]}}),{c(){t=P("main"),n=P("div"),s=x(e[5]),i=I(),o.c(),r=I(),pe(c.$$.fragment),l=I(),pe(d.$$.fragment),k(n,"class","error svelte-dk41iq"),k(t,"class","svelte-dk41iq")},m(e,o){A(e,t,o),b(t,n),b(n,s),b(t,i),p[a].m(t,null),b(t,r),me(c,t,null),b(t,l),me(d,t,null),u=!0},p(e,n){(!u||32&n[0])&&_(s,e[5]);let i=a;a=m(e),a===i?p[a].p(e,n):(oe(),le(p[i],1,1,(()=>{p[i]=null})),re(),o=p[a],o?o.p(e,n):(o=p[a]=h[a](e),o.c()),ce(o,1),o.m(t,r));const l={};64&n[0]&&(l.myKeyPair=e[6]),16&n[0]&&(l.open=e[4]),c.$set(l);const w={};8&n[0]&&(w.open=e[3]),d.$set(w)},i(e){u||(ce(o),ce(c.$$.fragment,e),ce(d.$$.fragment,e),u=!0)},o(e){le(o),le(c.$$.fragment,e),le(d.$$.fragment,e),u=!1},d(e){e&&C(t),p[a].d(),we(c),we(d)}}}const Wt="https://testnet.toncenter.com/api/v2/jsonRPC",Vt="36a585cf3e99d3c844e448b495c7b2f66bd279d4f4782540e1cf01ffa8833c50";function Dt(e,t,n){let s,i,a,o,{name:r}=t,c=[],l="",d=!1,u=!1,h="",p="WELCOME",m=!1,w=!1,f=1;const g=window.TonWeb,y=new g(new g.HttpProvider(Wt,{apiKey:Vt})),$=window.Telegram.WebApp,b=g.utils.nacl,T=async()=>{const e=await pt.wordsToPrivateKey(c);n(6,s=b.sign.keyPair.fromSeed(g.utils.base64ToBytes(e)));const t=y.wallet.all.v3R2;i=new t(y.provider,{publicKey:s.publicKey,wc:0}),n(7,a=(await i.getAddress()).toString(!0,!0,!0));const r=await y.provider.getWalletInfo(a);n(8,o=mt.getBalance(r))},v=async()=>{n(1,c=await g.mnemonic.generateMnemonic()),console.log(c),await T(),console.log(l)},A=async()=>{await pt.saveWords(c,l),n(2,l=""),n(9,p="LOGIN"),$.sendData(JSON.stringify({wallet:a,publicKey:s.publicKey,walletBalance:o,action:"walletCreated"}))};var C;C=async()=>{await ye.getItem("words")&&(n(3,d=!0),n(9,p="LOGIN"))},N().$$.on_mount.push(C);return e.$$set=e=>{"name"in e&&n(16,r=e.name)},e.$$.update=()=>{1&e.$$.dirty[0]&&m&&setTimeout((()=>{n(0,m=!1)}),2e3)},[m,c,l,d,u,h,s,a,o,p,w,f,$,v,A,async e=>{try{n(1,c=await pt.loadWords(e)),await T(),n(3,d=!1);const t=be();"createPaymentChannel"!=t.action&&"topUpAndInitPaymentChannel"!=t.action||n(4,u=!0),n(5,h="")}catch(e){n(5,h="ERROR")}},r,()=>{(e=>{navigator.clipboard.writeText(e)})(a),n(0,m=!0)},function(e){l=e,n(2,l)},async e=>{console.log(e),console.log(l)},async()=>{await pt.saveWords(c,l),n(2,l=""),n(10,w=!1)},()=>{n(10,w=!0)},()=>{$.sendData(JSON.stringify({wallet:a,publicKey:s?.publicKey,walletBalance:o,action:"walletDeleted"})),ye.clear(),n(9,p="WELCOME"),n(11,f=1)},()=>{n(11,f++,f)},async()=>{await v(),n(11,f++,f)},function(e){l=e,n(2,l)},e=>{"Enter"===e.key&&(e.preventDefault(),A())}]}return new class extends ge{constructor(e){super(),fe(this,e,Dt,Kt,r,{name:16},null,[-1,-1])}}({target:document.body,props:{name:"world"}})}();
//# sourceMappingURL=bundle.js.map
